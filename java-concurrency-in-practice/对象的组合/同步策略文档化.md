# 同步策略文档化
#Refactoring 

在维护线程安全性时，文档是最强大的（同时也是最未被充分利用）工具之一。开发和维护人员可通过查阅文档来理解其中的实现策略，避免在维护的过程中破坏安全性。

> 在文档中说明客户代码需要了解的线程安全性保证，以及代码维护人员需要了解的同步策略。

synchronized、volatile 或者任何一个线程安全类都对应于某种同步策略，用于在并发访问时确保数据的完整性。这种策略是程序设计的要素之一，因此应该将其文档化。

> ⚠️ 注意：设计阶段是编写设计决策文档的最佳时间。在几周后，一些设计细节会逐渐变得模糊，因此一定要在忘记之间记录下来。

文档需要考虑以下方面：

1. 哪些变量声明为 volatile 类型？
2. 哪些变量用锁来保护？
3. 哪些锁保护哪些变量？
4. 哪些变量必须是不可变的或者被封闭在线程中？
5. 哪些操作必须是原子操作？

线程安全性文档化要素：

1. 是否是线程安全的？
2. 执行回调时是否持有锁？
3. 是否有特定的锁影响行为？

> ⚠️ 注意：如果某个类没有明确的声明是线程安全的，那么就不要假设它是线程安全的，从而有效避免线程安全性问题。