# 以子类取代类型码
#Refactoring 

软件系统经常需要表现“相似但不同的东西”，比如员工可以按职位分类，订单可以按优先级分类。

表现分类关系的第一种工具是类型码字段 —— 根据具体的编程语言，可能实现为枚举、符号、字符串或者数字。类型码的取值经常来自给系统提供数据的外部服务。

## 动机

大多数时候，有这样的类型编码就够了。但有时可以更进一步，引入子类。

继承有两个好处。首先，可以用多态来处理条件逻辑，引入子类后可以用[[以多态取代条件表达式]]来处理这些函数。另外，部分字段或函数可能只对特定的类型码取值才有意义。此时创建子类，然后使用[[字段下移]]把字段放入合适的子类中。

使用该重构手法，需要考虑一个问题：应该处理携带类型码的这个类，还是应该处理类型码本身呢？前者通过直接的子类继承比较简单，但类型码就不能用在其他场合。后者需要运用[[以对象取代基本类型]]把类型码包装为类，然后对其使用[[以子类取代类型码]]。

## 做法

1. 自封装类型码字段。
2. 任选一个类型码取值，为其创建子类。覆写类型码类的取值函数，令其返回该类型码的字面量值。
3. 创建一个选择器逻辑，把类型码参数映射到新的子类中。

> 如果选择直接继承的方案，就用[[以工厂函数取代构造函数]]包装构造函数，把选择器逻辑放在工厂函数里；如果选择间接继承的方案，选择器逻辑保留在构造函数中。

4. 测试。
5. 针对每个类型码取值，重复上述“创建子类，添加选择器逻辑”的过程。每次修改后执行测试。
6. 去除类型码字段。
7. 测试。
8. 使用[[函数下移]]和[[以多态取代条件表达式]]处理原本访问了类型码的函数。全部处理后，就可移除类型码的访问函数。