# 搬移语句到调用者
#Refactoring 

作为程序员，我们的职责就是设计出结构一致、抽象合宜的程序，而程序抽象能力的源泉正是来自函数。

## 动机

与其他抽象机制一样，我们并非总能平衡好抽象的边界。随着系统能力发生演进，原先设定的抽象边界总会悄无声息地发生偏移。对于函数来说，这样的边界偏移意味着曾经视为一个整体、一个单元的行为，如今可能已经分化出两个甚至多个不同的关注点。

函数边界发生偏移的一个征兆是，以往在多个地方共用的行为，如今在某个调用点前需要表现出不同的行为。于是，使用[[移动语句]]把表现不同的行为从函数里挪出，并搬移到其调用处。

这个重构手法比较适合处理边界仅有些许偏移的场景，但有时调用点和调用者之间的边界已经相去甚远，此时只能重新进行设计。若如此，最好的办法是先用[[内联函数]]合并双方的内容，调整语句的顺序，再提炼出新的函数，以形成更合适的边界。

## 做法

1. 最简单的情况下，原函数非常简单，其调用者也只有寥寥一两个，此时只需把要搬移的代码从函数里剪切出来并粘贴回调用端去即可，必要的时候做些调整，运行测试。
2. 若调用点不止一个，则需要先用[[提炼函数]]将你不想搬移的代码提炼成一个新函数，函数名可以临时起一个，只要后续容易搜索即可。

> 如果原函数是一个父类方法，并且有子类覆盖，那么对所有子类的覆盖方法进行同样的提炼操作，保证继承体系上每个类都有一份与超类相同的提炼函数。接着将子类的提炼函数删除，让它们引用超类提炼出来的函数。

3. 对原函数应用[[内联函数]]。
4. 对提炼出来的函数应用[[改变函数声明]]，令其与原函数使用同一个名字。