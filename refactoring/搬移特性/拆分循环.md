# 拆分循环
#Refactoring 

代码中常见一些身兼多职的循环。

## 动机

当你在一个循环中做了两件不同的事，那么每当需要修改循环时，你都得理解这两件事。如果可以拆分循环，就能确保每次修改时你只需要理解要修改的代码。

拆分循环可以让每个循环更容易使用。如果一个循环只计算一个值，那么直接返回该值即可。如果循环做了许多事，那就只得返回结构型数据或者通过局部变量传值。因此拆分循环之后会紧接着[[提炼函数]]。

这项重构手法可能让许多程序员感到不安，会迫使你执行两次循环。对此，我们保持一贯的建议：先重构再优化。需要先保持代码结构变得清晰，才能做进一步的优化；如果重构后确实成了性能的瓶颈，那时再把拆开的循环合到一起也很容易。

> 实际上，即使处理数据多一些，循环也很少成为性能瓶颈，更何况拆分出循环来通常还使一些更强大的优化手段成为可能。

## 做法

1. 复制一遍循环代码。
2. 识别并移除循环中的重复代码，使每个循环只做一件事。
3. 测试。

完成循环拆分后，考虑对每个循环进行[[提炼函数]]。