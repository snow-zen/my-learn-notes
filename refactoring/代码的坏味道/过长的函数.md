# 过长的函数
#Refactoring 

活得最长、最好的程序，其中的函数都比较短。间接性带来的好处 —— 更好的阐释力、更易于分享、更多的选择 —— 都是由小函数来支持的。

最终的效果是：你应该积极地分解函数。我们遵循一个原则：每当感觉需要以注释来说明点什么的时候，我们就把需要说明的东西写进一个独立的函数中，并以其用途（而非手法）命名。

> 只要函数能够解释其用途，哪怕替换后函数调用动作比函数自身要长，也该毫不犹豫地那么做。

绝大多数将函数变短的场合中，只需要使用[[提炼函数]]，将它们提炼成一个新函数。而如果函数内有大量的参数和临时变量，它们会对提炼过程形成阻碍。此时，可以经常运用[[以查询取代临时变量]]来消除临时变量。[[引入参数对象]]和保持[[对象完整]]则可以将过长的参数列表变得简洁一些。

如果已经这样做了，但还是有太多的临时变量和参数，那就应该使用杀手锏 —— [[以命令取代函数]]。

**如果确定需要提炼的代码？**

寻找注释，它们通常提醒你代码用途和实现手法之间的语义距离。如果代码前方存在一行注释，就是在提醒你：可以将这段代码替换成一个函数，而且可以在注释的基础上给这个函数命名。

> 就算只有一行代码，如果它需要用注释来说明，那也值得将它提炼到独立函数中。

条件表达式和循环常常也是提炼的信号。可以使用[[分解条件表达式]]处理条件表达式。对于庞大的 switch 语句，其中的每个分支都应该通过[[提炼函数]]变成独立函数。如果多个 switch 语句基于同一个条件进行分支选择，就应该使用[[多态取代条件表达式]]。

至于循环，应该将循环和循环内的代码提炼到一个独立的函数中。如果发现提炼出的循环很难命名，可能是循环中做了几件不同的事。如果这种情况，请使用[[拆分循环]]将其拆分成各自独立的任务。