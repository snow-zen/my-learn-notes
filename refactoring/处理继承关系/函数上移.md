# 函数上移
#Refactoring 

避免重复代码是很重要的。

## 动作

重复函数或许现在可以正常工作，但后续只会成为 bug 的温床。无论何时，只要系统内出现重复，你就会面临“修改其中一个却未能修改另一个”的风险。如果某个函数在各个子类中的函数体都相同，这就是显而易见的函数上移适用场景。

函数上移常常紧随其他重构而被使用。也许能找出若干个身处不同子类内的函数，而它们又可以通过某种形式的参数调整为相同的函数。这时候，最简单的办法就是先分别对这些函数应用[[函数参数化]]，然后再函数上移。

函数上移中往往会引用到只出现在子类而不出现在父类的特性。此时，就得用[[字段上移]]和[[函数上移]]先将特性提示到父类中。

如果两个函数工作流程大体相似，但实现细节略有差异，那么考虑先借助[塑造模板函数](https://refactoring.com/catalog/formTemplateMethod.html)构造出相同的函数，然后再提升它们。

## 做法

1. 检查待提升函数，确定它们是完全一致的。

> 如果函数行为一致，但函数体并不完全一致，那么先对它们进行重构，直到其函数体完全一致。

2. 检查函数体内引用的所有函数调用和字段都能从父类中调用到。
3. 如果待提升的函数签名不同，使用[[改变函数声明]]将函数签名修改为期望在父类中使用的签名。
4. 在父类中新建函数，将某待提升函数代码复制其中。
5. 执行静态检查。
6. 移除一个待提升的子类函数。
7. 测试。
8. 逐一移除待提升的子类函数，直到只剩下超类中的函数为止。