# 搬移语句到函数
#Refactoring 

要维护代码库的健康发展，需要遵守几条黄金守则，其中最重要的一条当属“消除重复”。

## 动机

如果发现调用某个函数时，总有一些相同的代码也需要每次执行，则可以考虑将此段代码合并到函数里头。日后对这段代码的修改只需改一处，还能对所有调用者生效。

如果将来代码对不同的调用者需有不同的行为，那时再通过[[搬移语句到调用者]]将它搬移出来也十分简单。

如果某些语句与一个函数放在一起更像一个整体，并且更有助于理解，则应该毫不犹豫地将语句搬移到函数里。如果它们与函数不像一个整体，但仍应与函数一起执行，则可以使用[[提炼函数]]将语句提炼出去。

## 做法

1. 如果重复代码段离调用目标函数的地方还有些距离，则用[[移动语句]]将语句挪动到紧邻目标函数的位置。
2. 如果目标函数仅被唯一一个源函数使用，则只需将源函数中的重复代码段剪切并粘贴到目标函数中即可，然后运行测试。
3. 如果函数不止一个调用点，可先选择其中一个调用点应用提炼函数，将待搬移语句与目标函数一起提炼成一个新函数。给新函数取个临时名，只要易于搜索即可。
4. 完成所有引用点的替换后，应用[[内联函数]]将目标函数内联到新函数里，并移除原目标函数。
5. 对新函数应用[[改变函数声明]]，将其改为原目标函数的名字。

