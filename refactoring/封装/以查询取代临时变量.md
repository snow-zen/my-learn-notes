# 以查询取代临时变量
#Refactoring 

临时变量即函数中定义的变量，会随着函数生命周期的结束而消失。

## 动机

临时变量的一个作用是保存某段代码的返回值，以便函数的后面部分使用它。临时变量允许我引用之前的值，即能解释它的含义，还能避免对代码进行重复计算。

尽管使用变量很方便，很多时候还是值得更进一步，将它们抽取成函数。尤其是在分解冗长函数时，将变量抽取到函数里能使函数的分解过程更简单，因为就不再需要将变量作为参数传递给提炼出来的小函数。将变量的逻辑放在函数中，有助于在提炼得到的函数和原函数之间设立清晰的边界，这能帮助发现并避免难缠的依赖及副作用。

改用函数还让我避免了在多个函数中重复编写逻辑。每当在不同的地方看见同一段变量的计算逻辑时，就会设法将其挪到同一函数中。

> 这项重构手法在类中施展效果最好，因为类为待提炼函数提供了一个共同的上下文。如果不是类中，可能在顶层函数中拥有过多的参数，这将冲淡提炼函数所能带来的诸多好处。使用嵌套函数虽然可以避免这个问题，但又限制在相关函数间分享逻辑的能力。

该重构手法只适用于处理某些类型的临时变量：那些只被计算一次且之后不再被修改的变量。

## 做法

1. 检查变量在使用前是否已经完全计算完毕，检查计算它的那段代码是否每次都能得到一样的值。
2. 如果变量目前不是只读的，但是可以改造成只读变量，那就先改造它。
3. 测试。
4. 将为变量赋值的代码提炼为函数。

> 如果变量和函数不能使用同样的名字，那么先为函数取个临时名字。确保待提炼的函数没有副作用。若有，则先应用[[将查询函数和修改函数分离]]隔离副作用。
5. 测试。
6. 使用[[内联变量]]移除变量。