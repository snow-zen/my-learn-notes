# 霰弹式修改
#Refactoring 

霰弹式修改类似于[[发散式变化]]，但又恰恰相反。

> 发散式变化是站在宏观层面上进行的修改，往往关注的是代码的上下文边界是否合理。而霰弹式修改则是具体到某个操作进行分析。

如果每遇到变化，你都必须在许多不同的类内做出许多小修改，则你所面临的坏味道就是霰弹式修改。修改的内容散步四处，不但难以找到，并且也很容易错过某个重要的修改。

这种情况下，应该使用[[搬移函数]]和[[搬移字段]]把所有需要修改的代码放入同一模块里。如果有许多函数都在操作相似的数据，可以使用[[函数组合成类]]。如果有些功能的是转化或者充实数据结构，可以使用[[函数组合成变换]]。如果一些函数的输出可以组合后提供给一段专门使用这些计算结果的逻辑，这时常常用得上[[拆分阶段]]。

面对霰弹式修改，一个常用的策略是使用与内联相关的重构 —— 如[[内联函数]]或者[[内联类]]，把本不该分散的逻辑拽回一起。完成内联后，可能会闻到过长函数或过大类的坏味道，不过还可以使用提炼相关手法将其拆解成更合理的小块。

> 我们最终会拆分出小型的函数和类，因此我们并不需要担心在重构的过程中暂时创建一些较大的程序单元。