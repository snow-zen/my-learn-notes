# 可变数据
#Refactoring 

对数据的修改经常导致出乎意料的结果和难以发现的 bug。在一处更新数据却没有意识到软件的另一处期望着完全不同的数据。

可以使用[[封装变量]]来确保所有数据更新操作都通过很少的几个函数来进行，使其更容易监控和演讲。

如果一个变量在不同时候被用于存储不同的东西，可以使用[[拆分变量]]将其拆分为各自不同用途的变量，从而避免危险的更新操作。

使用[[移动语句]]和[[提炼函数]]尽量把逻辑从处理更新操作的代码中搬移出来，将没有副作用的代码与执行数据更新操作的代码分开。

设计 API 时，可以使用[[将查询函数和修改函数分离]]确保调用者不会调用到有副作用的代码，除非它们真的要更新数据。

尽早使用[[移除设值函数]] —— 有时只是把设值函数的使用者找出来看看，就能帮我们发现缩小变量作用域的机会。

> 注意：当可变数据的值可以在其他地方计算出来时，这就是一个坏味道。消除这种坏味道的办法很简单，使用[[以查询取代派生变量]]代替即可。

当变量作用域只有几行代码时，即使其中的数据可变，也不是什么大问题；但它会随着变量作用域的扩展，风险也随之增大。可以使用[[函数组合成类]]或者[[函数组合成变换]]来限制需要对变量进行修改的代码量。

如果一个变量在内部结构中包含了数据，通常最好不要直接修改其中的数据，而是用[[将引用对象改为值对象]]令其直接替换整个数据结构。