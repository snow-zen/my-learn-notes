# 提炼函数
#Refactoring 

提炼函数是最常用的重构之一。

## 动机

如果你需要花时间浏览一段代码才能弄清它到底在干什么，那么就应该将其提炼到一个函数中，并根据它所做的事为其命名。

写非常小的函数 —— 通常只有几行的长度。有人担心短函数会造成大量函数调用，因而影响性能。而实际上短函数常常能让编译器的优化功能运转更良好，因此短函数可以更容易地被缓存。

> 应始终遵循性能优化的一般指定方针，不用过早担心性能问题。

小函数得有个好名字才行，所以你必须在命名上花心思。起好名字需要练习，不过一旦你掌握了其中的技巧，就能写出很有自描述性的代码。

## 做法

1. 创造一个新函数，根据函数的意图来命名（以它“做什么”来命名，而不是以它“怎样做”命名）。
2. 将待提炼的代码从源函数复制到新建的目标函数中。

> 如果编程语言支持嵌套函数，就把新函数嵌套在源函数中，这能减少后面需要处理超过作用域的变量个数。并且可以稍后使用[[搬移函数]]把它从源函数中搬移出去。

3. 仔细检查提炼出的代码，看看其中是否引用了作用域限于源函数、在提炼的新函数中访问不到的变量。若存在，则以参数的形式传递给新函数。

> 如果变量传递到提炼的函数中时被赋值，如果只有一个这样的变量，可尝试将提炼的新函数变成一个查询，用返回值给变量赋值。如果这样的变量过多时，可先考虑其他重构手法，例如[[拆分变量]]或者[[以查询取代临时变量]]，来简化变量的使用情况，之后在考虑提炼函数。

4. 所有变量都处理完后，编译。
5. 在源函数中，将被提炼代码段替换为对目标函数的调用。
6. 测试。
7. 查看其他代码是否与被提炼的代码段相同或相似之处。如果有，考虑使用[[以函数调用取代内联代码]]令其调用提炼出的新函数。