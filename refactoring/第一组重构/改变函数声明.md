# 改变函数声明
#Refactoring 

函数是我们将程序拆分成小块的主要方式。

## 动机

函数声明则展现了如果将这些小块组合在一起工作 —— 可以说，它们就是软件系统的关节。和任何构造体一样，系统的好坏很大程度上取决于关节。好的关节使得给系统添加新部件很容易；而糟糕的关节则不断招致麻烦，让我们难以看清软件的行为。

对于这些关节而言，最重要的元素当属函数的名字。一个好名字能让我一眼看出函数的用途，而不必查看其实现代码。

对于函数的参数，道理也是一样的，函数的参数列表阐述了函数如何与外部世界共处。修改参数列表不仅能增加函数的应用范围，还能改变连接一个模块所需的条件，从而去除不必要的耦合。

至于何时改变以及如果选择正确的参数？对于这个问题，唯一正确的答案是”没有正确答案“，而且答案还会随着时间变化。掌握改变函数声明的手法后，这样当我想好代码中应该有哪些关节时，才能使代码随着我的理解而演讲。

## 做法

**简单的做法**

1. 如果想移除一个参数，需要先确定函数体内没有使用该参数。
2. 修改函数声明，使其成为你期望的状态。
3. 找出所有使用旧函数声明的地方，将它们改为使用新函数声明。
4. 测试。

最好将大的修改拆分为小的修改，所以如果你既想修改函数名，又想添加参数，最好分成两步做。

**迁移式做法**

1. 如果有必要，先对函数体内部加以重构，使后面的提炼步骤易于开展。
2. 使用[[提炼函数]]将函数体提炼成一个新函数。

> 如果打算沿用旧函数的名字，可以先给新函数起一个易于搜索的临时名字。

3. 如果提炼出的函数需要新增参数，用前面简单做法添加即可。
4. 测试。
5. 对旧函数使用[[内联函数]]。
6. 如果新函数使用临时名字，再次使用[[改变函数声明]]将其改回原来的名字。
7. 测试。

如果重构的函数属于一个多态的类，那么对于这个函数的每个实现版本，你都需要通过”提炼一个新函数“的方式添加一层间接，并把旧函数的调用转发到新函数上。

如果该函数的多态性是在一个类继承体系中体现的，那么只需要在父类上转发即可；如果各个实现类没有共同的父类，那么就需要在每个实现类上做转发。

如果重构一个已对外发布的 API，在提炼出新函数之后，可以暂停重构，将原来的函数声明为”不推荐使用“，然后给客户端一点时间转为使用新函数。等到你有信心所有客户端都已经从旧函数迁移到新函数时，再移除旧函数的声明。