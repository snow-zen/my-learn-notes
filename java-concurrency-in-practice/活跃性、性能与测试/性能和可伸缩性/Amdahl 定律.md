# Amdahl 定律
#Java #Multithreading 

有些问题中，可用资源越多，问题的解决速度就越快，因为任务是并行的。而有些任务本质上是串行的，因此增加多个处理器也不能发挥出处理能力。

Amdahl 定律描述：在增加计算资源的情况下，程序在理论上能够实现最高加速比，这个比值取决于程序中可并行组件与串行组件所占的比重。

假定 $F$ 是必须被串行执行部分，那么根据 Amdahl 定律，在包含 $N$ 个处理器的机器中，最高加速比是：$Speedup \le {\frac 1 {F + {\frac {(1 - F)} N}}}$。

当 $N$ 趋近于无穷大时，${\frac {(1 - F)} N}$ 为 0，最大加速比趋近于 ${\frac 1 F}$。

因此当程序串行部分 $F = 50\%$ 时，最高加速比为 $Speedup = 2$；当程序串行部分 $F = 10\%$ 时，最高加速比为 $Speedup = 10$。

Amdahl 定律还量化了串行化的效率开销。在拥有 10 个处理器的系统中，如果程序中有 10% 的部分需要串行执行，那么最高的加速比为 5.3，在拥有 100 个处理器的系统中，加速比可以达到 9.2。即使拥有无限多的 CPU，加速比也不可能为 10。

![在串行部分所占不同比例下的最高利用率](https://my-images-repo.oss-cn-hangzhou.aliyuncs.com/java-concurrency-in-practice/%E5%9C%A8%E4%B8%B2%E8%A1%8C%E9%83%A8%E5%88%86%E6%89%80%E5%8D%A0%E4%B8%8D%E5%90%8C%E6%AF%94%E4%BE%8B%E4%B8%8B%E7%9A%84%E6%9C%80%E9%AB%98%E5%88%A9%E7%94%A8%E7%8E%87.jpeg)

在所有并行任务中始终有一部分串行的任务：共享变量的读取、并行任务结果的处理。如果你认为在你的程序中不存在串行部分，那么可以再仔细检查一遍。

## Amdahl 定律的应用

如果能够准确估计出执行过程中串行部分所占的比例，那么 Amdahl 定律就能量化当有更多的计算资源可用时的加速比。虽然要直接测量串行部分的比例非常困难，但即使在不进行测试的情况下 Amdahl 定律仍然是有用的。

在评估一个算法时，要考虑算法在数百个或数千个处理器的情况下的性能表现，从而对可能出现的可伸缩性局限有一定程度的认识。在一些系统中存在的具有可伸缩性的算法可能含有一些隐藏的可伸缩性瓶颈，只是还没有遇到而已。