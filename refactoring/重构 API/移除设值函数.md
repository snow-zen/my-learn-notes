# 移除设值函数
#Refactoring 

如果某个字段提供了设值函数，这就暗示这个字段可以被改变。

## 动机

如果不希望在对象创建后此字段还可以被改变，那就不要为它提供设值函数。这样一来，该字段就只能在构造函数中赋值，并且可以排除该值被修改的可能。

> 移除的字段设值函数越多，该类就越容易成为不可变类。

有两种常见的情况需讨论。一种情况是：有些人喜欢始终通过访问函数来读写字段，移除后构造函数就成了他唯一的访问途径。若果真如此，则更愿意去除设值函数，以此表达出“构造后不应该再更新字段值”的意图。

另一种情况是，对象是由客户端通过创建脚本构造出来的，而不是只有一次简单的构造函数调用。所谓“创建脚本”，首先调用构造函数，之后通过一系列设值函数调用来完成对象的构造。执行完成后，新对象的部分字段就不应该被修改。此时设值函数只应该在起初的对象创建过程中被调用，这更应该去除设值函数，从而清晰表达出我的意图。

## 做法

1. 如果构造函数尚无法得到想要设入字段的值，就使用[[改变函数声明]]将这个值以参数的形式传入构造函数。在构造函数中调用设值函数，对字段设值。

> 如果想移除多个设值函数，可以一次性把它们的值都传入构造函数，这能简化后续步骤。

2. 移除所有在构造函数之外对设值函数的调用，改为使用新的构造函数。每次修改之后都要测试。

> 如果不能把“调用设值函数”替换为“创建一个新对象”（例如需要更新一个多处共享引用的对象），请放弃本重构。

3. 使用[[内联函数]]消去设值函数。如果可能，把字段声明为不可变。
4. 测试。