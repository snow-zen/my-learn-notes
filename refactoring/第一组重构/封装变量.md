# 封装变量
#Refactoring 

数据重构要比函数重构麻烦得多，因为没办法像函数那样拥有转发机制，更不好进行移动。

## 动机

如果想要搬移一处被广泛使用的数据，最好的办法往往是先以函数形式封装所有对该数据的访问。将“重新组织数据”的困难任务转化为“重新组织函数”这个相对简单的任务。

封装变量还能提供一个清晰的观测点，可以由此监控数据的变化和使用情况。并且可以在修改数据时添加验证逻辑。

> 对应所有作用域超过单个函数的可变数据，就应该将其封装起来，只允许通过函数进行访问。

封装变量虽然很重要，但是不可变变量更为重要。如果变量不可修改，则根本不需要数据更新前的验证或者其他逻辑钩子。并且可以无需[[必要时进行保护性拷贝|保护性拷贝]]。

> 不可变性是强大的代码防腐剂。

## 做法

1. 创建封装函数，在其中访问和更新变量值。
2. 执行静态检查。
3. 逐一修改使用该变量的代码，将其改为调用合适的封装函数。每次替换之后，执行测试。
4. 限制变量的可见性。

> 有时没有办法估计还在访问变量的代码位置。若果真如此，可以试试将变量改名，再执行测试，找出仍在直接使用该变量的代码。

5. 测试。
6. 如果变量的值是一个记录，考虑使用[[封装记录]]。