# 谨慎地进行优化
#Java 

有三条与优化有关的格言应该是每个人都应该知道的：

> 很多计算上的过失都被归咎于效率（没有达到必要的效率），而不是任何其他的原因——甚至包括盲目地做傻事。——William A. Wulf

> 不要去计较效率上的一些小小的得失，在 97% 的情况下，不成熟的优化才是一切问题的根源。——Donald E. Knuth

> 在优化方面，我们应该遵守两条规则： 
规则 1：不要进行优化 
规则 2: （仅针对专家）还是不要进行优化。
就是说，在你还没有绝对清晰的未优化方案之前，请不要进行优化。——M.A. Jackson

这些格言都比 Java 程序设计语言都早出现 20 年。它们讲述了一个关于优化的深刻理解：优化的弊大于利，特别是不成熟的优化。在优化的过程中，产生的软件可能即不快速，也不正确，而且还不容易修改正确。

> ⚠️ 注意：不要为了性能而牺牲合理的结构。要努力编写好的程序而不是快的程序。

如果好的程序不够快，它的结构将使它可以得到优化。好的程序体现了信息隐藏的原则：只要有可能，它们就会把设计决策集中在单个模块中，因此可以改变单个决策，而不会影响到系统的其他部分。

> ⚠️ 注意：但这并不意味着在完成程序之前就可以忽略性能问题。实现上的问题可以通过后期的优化而得到修正，但是，遍布全局并且限制性能的结构缺陷几乎是不可能被改正的，除非重新编写系统。因此，必须在设计过程中考虑到性能问题。

要努力避免那些限制性能的设计决策。当一个系统设计完成之后，其中最难以更改的组件是那些指定了模块之间交互关系以及模块与外界交互关系的组件。

幸运的是，一般而言，好的 API 设计也会带来好的性能。但是为了获得好的性能而对 API 进行包装，这是一种非常不好的想法。

对于 Jackson 提出的两条优化原则，可以增加一条：在每次试图做优化之前和之后，要对性能进行测量，防止对实际性能影响点的误判。性能剖析工具有助于决定应该把优化的重心放在哪里。值得特别提及的另一种工具是 JMH，它不是性能剖析工具，而是微基准测试框架，它提供了非并行地可见 Java 代码性能详情的能力。