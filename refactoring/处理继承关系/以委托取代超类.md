# 以委托取代超类
#Refactoring 

在面向对象程序中，通过继承来复用现有功能，是一种强大而又便捷的功能。

## 动机

通过只要继承一个已有的类，覆写一些功能，再添加一些功能，就能达到目的。但继承也有可能造成困扰和混乱，如果父类的一些函数对子类并不适用，就说明不应该通过继承来获得父类的功能。

除了“子类用得上父类的所有函数”之外，合理的继承关系还有一个重要特征是：子类的所有实例都应该是父类的实例，通过父类的接口来使用子类的实例应该完全不出问题。

有问题的继承招致混乱和错误 —— 如果把继承关系改为将部分职能委托给另一个对象，这些混乱和错误本是可以轻松避免的。使用委托关系能更清晰地表达“这是另一个东西，我只是需要用到其中携带的一些功能”。

即使在子类和父类是合理建模的情况下，如果子类和父类的耦合过强时，父类的变化也会很容易破坏子类的功能，此时也应该使用该重构手法。

总之，应首先使用继承，如果发现继承有问题，再使用以委托取代超类。

## 做法

1. 在子类中新建一个字段，使其引用父类的一个对象，并将这个委托引用初始化为父类的新实例。
2. 针对父类的每个函数，在子类中创建一个转发函数，将调用请求转发给委托引用。每转发一块完成逻辑，都要执行测试。

> 大多数时候，每转发一个函数就可以测试，但一对设值/取值必须同时转移，然后才能测试。

3. 当所有超类函数都被转发函数覆写后，就可以去掉继承关系。

