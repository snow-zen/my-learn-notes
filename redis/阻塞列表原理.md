# 阻塞列表原理
#Redis 

Redis 中的 List 命令中，存在一组可阻塞的命令。

## 阻塞过程

当一个阻塞命令的目标键不存在时，执行该阻塞命令的客户端就会被阻塞。阻塞操作可以分为以下几个步骤：

1. 将客户端的状态设置为 “正在阻塞”，并记录阻塞这个客户端的键，以及阻塞的超时时间等信息。
2. 将客户端的信息记录到 blocking_keys 字典中。
3. 继续维持客户端和服务器之间的网络连接，但不再向客户端传输任何信息，造成客户端阻塞。

blocking_keys 字典是一个哈希表，由造成客户端阻塞的目标键作为哈希表的键，值为链表，链表里保存了所有因键而阻塞的客户端：

![blocking_key](https://my-images-repo.oss-cn-hangzhou.aliyuncs.com/redis/blocking_keys.png)

## 阻塞取消过程

阻塞取消有三种方法：

1. 被动取消：有其他客户端为造成阻塞的键加入新的元素。
2. 主动取消：达到执行阻塞命令设置的超时时间。
3. 强制脱离：客户端强制终止和服务器的连接，或者服务器停机。


参考链接：

[Redis 列表阻塞命令的实现](https://www.cnblogs.com/zpcoding/p/12980362.html)