# 搬移字段
#Refactoring 

编程活动中你需要编写许多代码，为系统实现特定行为，但往往数据结构才是一个健壮程序的根基。

## 动机

一个适应于问题域的良好数据结构，可以让行为代码变得简单明了，而糟糕的数据结构则将招致许多无用的代码。

因此，好的数据结构至关重要 —— 不过这也和其他编程活动一样，它们都很难一次性做对。通常应该做一些预先的设计，设法得到最恰当的数据结构，此时如果具备一些领域驱动设计方面的经验和知识，往往有助于更好的设计数据结构。

> ⚠️ 注意： 当发现数据结构已经不适应于需求，就应该马上修缮它。如果容许瑕疵进一步累积，它们就会使我变得困惑，让代码进一步复杂。

## 做法

1. 确保源字段已经得到良好的封装。
2. 测试。
3. 在目标对象上创建一个字段（及对应的访问函数）。
4. 执行静态测试。
5. 确保源对象里能够正常引用目标对象。

> 也许你已经有现成的字段或函数可以获得目标对象。如果没有，则看看是否可以简单创建一个方法就完事。如果还是不行，就可能得在源对象里创建一个字段，用于存储目标对象。这次修改可能留存很久，可以等到系统其他部分的重构完成后就回来移除它。

6. 调整源对象的访问函数，令其使用目标对象的字段。

> 如果源类的所有实例对象都共享目标对象的访问权，则可以考虑更新源类的设值函数，让它修改源字段，对目标对象上的字段做同样的修改。然后通过[[引入断言]]，当检测到源字段与目标字段不一致时抛出错误。一旦确定改动没有引入任何可观察的行为变化时，可以放心让访问函数直接使用目标对象的字段。

7. 测试。
8. 移除源对象上的字段。
9. 测试。