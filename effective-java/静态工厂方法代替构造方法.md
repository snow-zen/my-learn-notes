# 静态工厂方法代替构造方法
#Java

获取一个类的实例有两种方式：

1. 调用类的构造方法，创建类的实例。
2. 调用类提供的静态方法，方法返回类的实例。

例如，获取 Boolean 类实例可通过调用 `valueOf` 方法获取：

```java
public static Boolean valueOf(boolean b) {
	return (b ? TRUE : FALSE);
}
```

类通过发布静态工厂方法而非构造函数供客户端获取类实例，这种方式既有优势又有劣势。

## 静态工厂方法有名称

静态工厂方法可以通过声明适当的方法名来描述所返回类实例的状态。

相较于静态工厂方法，构造方法在声明形式上存在以下问题：
1. 构造方法参数并不能非常明确地描述调用时所返回类实例的状态。
2. 多个构造方法具有相同类型和数量的参数时，彼此之间参数的声明差异只有顺序不同。即使在程序上是合法的，但是客户端往往很难直观的理解并调用正确的构造方法。

> 在代码没有文档时，第 2 点所述问题往往会更容易表现出来。

## 静态工厂方法可共享实例

静态工厂方法在部分情况下被多次调用时，可以返回同一实例，避免多次创建相同状态实例。

例：Boolean 类实例只会存在两种状态，因此可提前创建并缓存实例，后续则无需再创建实例。

静态工厂方法可通过共享实例的特性实现[[单例模式]]。所有代码共享同一实例，程序中不会存在两个不相等的实例。

静态工厂方法也可以通过共享实例的特性实现[[享元模式]]。所有代码共享同一类下所有实例，对于不可变的值类不会出现两个相等的实例，即仅当满足 `a == b` 时，`q.equals(b)` 才能为 true。

> ⚠️ 注意：共享实例在发布时，需要保证它是无状态的或者在文档中标识它是线程不安全的。

另外，如果某个类实例的创建成本很高时，也可以通过静态工厂方法进行共享。

## 静态工厂方法可返回子类型实例

静态工厂方法在返回实例上可以利用多态的特性实现更高的灵活性。

这种灵活性的一种应用是：API 在声明返回类型后，API 实现可以返回声明类型的不同子类型的实例，同时又不会使不同子类型变为公有。这种方式可以隐藏实现类使 API 变得非常简洁，非常适合[基于接口的框架]()。

> 使用静态工厂方法返回子类型实例的特性，可以要求客户端通过接口来引用方法返回实例而不是具体的实现类，这是一种良好的习惯。

## 静态工厂方法可基于不同参数返回不同类型实例

基于[[静态工厂方法代替构造方法#静态工厂方法可返回子类型实例|静态工厂方法可返回子类型实例]]扩展而来的特性，静态工厂方法的返回实例可以根据传入的参数进行变动，且这种变动对于客户端是不可见的。

例：EnumSet 类没有构造方法，只有静态工厂方法。在 OpenJDK 的实现中，它所返回的具体实例取决于底层枚举类型的大小：如果它的元素小于等于 64 个，静态工厂方法返回一个 RegalarEnumSet 实例；如果它的元素大于等于 65 个，静态工厂方法就返回一个 JumboEnumSet 实例。

这种实现类不可见的特点，可以使后续的调整变动更为容易。即使未来某个实现类被删除或者代替，也不会造成任何负面的影响。

## 静态工厂方法返回实例类型可以没有具体实现类

基于[[静态工厂方法代替构造方法#静态工厂方法可返回子类型实例|静态工厂方法可返回子类型实例]]扩展而来的特性，在客户端代码编写时可以方法返回实例的类型可以没有具体实现类。

该特性构成了[[服务提供者框架]]，客户端在使用方法时可以与多个不同的实现类之间解耦。

## 静态工厂方法在文档中缺乏明确标识

相较于构造方法，静态工厂方法缺乏明确标识：
1. 语法上，静态工厂方法与其他方法并没有较大的差异。
2. Javadoc 中，静态工厂方法并没有像构造方法那样被明确标识出来。

缺乏明确标识使得静态工厂方法往往很难被关注，但是可以在类或者接口的文档注释中关注静态工厂方法，并且遵守标准的命名习惯，也可以弥补这一劣势。

常见的命名规则：
+ from：**类型转换方法**，单个参数实例，返回一个类型实例。
+ of：**聚合方法**，多个参数实例，返回一个类型实例。
+ valueOf：比 from 和 of 更烦琐的替代方法。
+ instance 或者 getInstance：返回的实例是通过方法的参数（如有）来决定的。
+ create 或者 newInstance：能够确保每次调用都会返回一个新的实例。
+ get*Type*：与 getInstance 类似，但在静态工厂方法返回不同类时使用。*Type* 表示工厂方法所返回的实例类型。
+ new*Type*：与 newInstance 类似，但在静态工厂方法返回不同类时使用。*Type* 表示工厂方法所返回的实例类型。
+ *type*：get*Type* 和 new*Type* 的简版。

## 总结

静态工厂方法与构造方法各有优劣，但大多数情况下静态工厂方法会更加合适，因此切忌第一反应就是提供公有的构造方法，而不先考虑静态工厂。