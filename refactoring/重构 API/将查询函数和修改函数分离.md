# 将查询函数和修改函数分离
#Refactoring 

如果某个函数只是提供一个值，没有任何看得到的副作用，那么这是一个很有价值的东西。

## 动机

任何有返回值的函数，都不应该有看得到的副作用 —— [命令与查询分离](https://martinfowler.com/bliki/CommandQuerySeparation.html)。有些程序员甚至将此作为一条必须遵守的规则，就像对待任何东西一样，我并不绝对遵守它，但也会尽量遵守，而它也回报很好的效果。

> 当遇到一个“既有返回值又有副作用”的函数时，会试着将查询动作从修改动作中分离出来。

## 做法

1. 复制整个函数，将其作为一个查询来命名。

> 如果没有好名字，可以看函数返回什么。查询的结果会被填入一个变量，这个变量的名字应该能对函数如果命名有所启发。

2. 从新建的查询函数中去掉所有造成副作用的语句。
3. 执行静态检查。
4. 查询所有调用原函数的地方。如果调用处用到了该函数的返回值，就将其改为调用新建的查询函数，并在下面马上再调用一次原函数。每次修改之后都要测试。
5. 从原函数中去掉返回值。
6. 测试。