# ACL 访问控制

ZooKeeper 使用 ACL 来控制对其 znode 的访问。ACL 实现与 UNIX 文件访问权限非常相似：它使用权限来控制对节点的各种操作的适用范围，但不同的是 ZooKeeper 中没有所有者的概念，而是指定一组 id 和与这些 id 关联的权限。

> 还需要注意的是：ACL 仅适用于特定的 znode，并不适用于子节点。例如，/app 在只能被 ip:172.16.16.1 读取时，/app/status 可以被所有人读取，因此 ACL 不是递归的。

当客户端连接到 ZooKeeper 并对其自身进行身份验证时，ZooKeeper 会将与客户端对应的所有 id 与客户端相关联。当客户端尝试访问节点时，这些 id 会作为 znode 的 ACL 检查依据。

> ACL 由成对的 (scheme:expression, perms) 组成，例如 (ip:19.22.0.0/16, READ)。

## ACL 权限

ZooKeeper 支持以下权限：

+ **CREATE**：可创建子节点。
+ **READ**：可查询节点数据并列出子节点。
+ **WRITE**：可为节点设置数据。
+ **DELETE**：可删除子节点。
+ **ADMIN**：可设置权限。

## ACL 方案

ZooKeeper 支持可插入的身份验证方案，使用 `scheme:expression` 指定。其中 scheme 是对应的身份验证方案。

有效表达式的集合由方案定义。例如，`ip:172.16.16.1` 是使用 ip 方案的地址为 172.16.16.1 的主机，而 `digest:bob:password` 是使用摘要方案的名称为 bob 用户。

### 内置 ACL 方案

ZooKeeper 具有以下内置方案：

+ **world**：该方案只有一个表达式，即 anyone。表示任何人。
+ **auth**：特殊方案，它忽略任何提供的表达式，而是使用当前用户、凭据和方案。在持久化 ACL 时，会忽略提供的任何表达式。但是，由于匹配格式原因仍必须在 ACL 中提供表达式。此方案是为了方便，因为它是用户创建 znode 然后对该 znode 的访问限制为仅该用户的常见用例。
+ **digest**：摘要在 ACL 中表达式将是 username:base64 编码的 SHA1 密码摘要。
+ **ip**：使用客户端 IP，表达式格式为 addr/bit，其中 addr 的最高有效位与客户端主机 IP 的最高有效位相匹配。
+ **x509**：使用客户端 X500 Principal，表达式是客户端确切的 X500 主机名称。使用安全端口时，客户端会自动进行身份验证，并设置 x509 方案的身份验证消息。



