# 引入特例
#Refactoring 

一种常见的重复代码情况是：一个数据结构的使用者都在检查某个特殊的值，并且当这个特殊的值出现时所做的处理都相同的。

## 动机

当发现代码库中有多处以相同的方式应对同一个特殊值时，应该把这个处理逻辑收拢到一处。

处理这种情况的一个好办法就是使用“特例”模式：创建一个特例元素，用以表达对这种特例的共同行为的处理。这样可以使用一个函数调用取代大部分特例检查逻辑。

特例有几种表现方式。如果只需要从对象中读取数据，可以提供一个字面量对象，其中所有值都是预先填充好的。如果除了简单数值外还需要更多行为，就需要创建一个特殊对象，其中包含所有共同行为的函数。

特例对象可以由一个封装类来返回，也可以通过变换插入一个数据结构。一个通常需要特殊处理的值就是 null，因此这个模式也经常称作“Null 对象”模式。

## 做法

1. 给重构目标检测特例的属性，令其返回 false。
2. 创建一个特例对象，其中只有检查特例的属性，返回 true。
3. 对“与特例值做比对”的代码运用提炼函数，确保所有客户端都使用这个新函数，而不再直接做特例值的比对。
4. 将新的特例对象引入代码中，可以从函数调用中返回，也可以在变换函数中生成。
5. 修改特例比对函数的主体，在其中直接使用检查特例的属性。
6. 测试。
7. 使用[[函数组合成类]]或[[函数组合成变换]]，把通用的特例处理逻辑都搬移到新建的特例对象中。

> 特例类对于简单的请求通常会返回固定的值，因此可以将其实现为字面记录。

8. 对特例比对函数使用内联函数，将其内联到仍然需要的地方。